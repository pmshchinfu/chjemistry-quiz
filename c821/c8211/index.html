<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ–å­¸å¼ç²¾ç†Ÿç·´ç¿’ - é¾é’åºœè€å¸«</title>
    <style>
        :root { --primary: #2c3e50; --secondary: #3498db; --accent: #9b59b6; --bg: #f4f7f6; --success: #27ae60; --error: #e74c3c; }
        body { font-family: 'Segoe UI', "Microsoft JhengHei", sans-serif; margin: 0; display: flex; height: 100vh; overflow: hidden; background: var(--bg); }
        
        /* å·¦å´å·¥å…·å€ */
        .sidebar-tools { width: 250px; background: var(--primary); padding: 25px; display: flex; flex-direction: column; gap: 20px; box-shadow: 2px 0 10px rgba(0,0,0,0.1); color: white; }
        .sidebar-tools h3 { border-bottom: 2px solid #34495e; padding-bottom: 10px; text-align: center; }
        .tool-btn { padding: 15px; font-size: 16px; background: var(--secondary); color: white; border: none; border-radius: 10px; cursor: pointer; transition: 0.3s; font-weight: bold; }
        .tool-btn:hover { background: #2980b9; transform: scale(1.02); }

        /* å³å´æ¸¬é©—å€ */
        .quiz-container { flex: 1; padding: 40px; overflow-y: auto; display: flex; flex-direction: column; align-items: center; }
        .card { background: white; width: 100%; max-width: 650px; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); text-align: center; }
        
        /* å½ˆçª—æ¨£å¼ */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); }
        .modal-content { position: relative; margin: 5% auto; width: 85%; max-width: 1000px; }
        .modal-content img { width: 100%; border-radius: 10px; }

        /* é¡Œç›®èˆ‡åº§è™Ÿæ¨£å¼ */
        .no-split { display: flex; gap: 10px; align-items: center; justify-content: center; margin: 10px 0; }
        .no-split select { width: 80px; padding: 8px; border-radius: 5px; }
        .q-text { font-size: 36px; margin: 25px 0; font-weight: bold; color: #2c3e50; }
        .options-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .option-btn { padding: 15px; font-size: 18px; border: 2px solid var(--secondary); border-radius: 10px; background: white; cursor: pointer; transition: 0.2s; }
        .option-btn:disabled { cursor: default; border-color: #ddd; color: #aaa; }
        
        /* è§£æç›’æ¨£å¼ */
        #explanation-box { display: none; margin-top: 20px; padding: 15px; border-radius: 10px; text-align: left; line-height: 1.6; }
        .exp-correct { background: #e8f5e9; border: 1px solid var(--success); color: var(--success); }
        .exp-wrong { background: #ffebee; border: 1px solid var(--error); color: var(--error); }

        .progress-bar { width: 100%; background: #eee; height: 12px; border-radius: 6px; margin-bottom: 15px; overflow: hidden; }
        #progress-fill { background: var(--secondary); height: 100%; width: 0%; transition: 0.3s; }
        .sub { vertical-align: sub; font-size: 0.6em; }
    </style>
</head>
<body>

<div class="sidebar-tools">  
    
    <button class="tool-btn" style="background:#e67e22;" onclick="window.open('chemical_formula_rules.pdf.pdf', '_blank')">ğŸ“„ è¬›ç¾©ï¼šåŒ–å­¸åæ‡‰å¼è¦ç¯„</button>
    <button class="tool-btn" style="background:#d35400;" onclick="window.open('typesOfchemical_formula.pdf', '_blank')">ğŸ“„ è¬›ç¾©ï¼šåŒ–å­¸å¼ç¨®é¡</button>
    
    <hr style="width:100%; border:0; border-top:1px solid #34495e;">
    <h3>ğŸ› ï¸ è¼”åŠ©å·¥å…·</h3>    
    <button class="tool-btn" onclick="openModal('modal-valence')">ğŸ“Š å…ƒç´ åƒ¹æ•¸åœ°åœ–</button>
    <button class="tool-btn" style="background:var(--accent);" onclick="openModal('modal-group')">ğŸ“‹ å¸¸ç”¨åŸå­åœ˜è¡¨</button>
    
    <hr style="width:100%; border:0; border-top:1px solid #34495e;">
    
    <button class="tool-btn" style="background:#95a5a6;" onclick="location.href='../index.html'">ğŸ  å›ç« ç¯€é¦–é </button>
</div>

    <div class="quiz-container">
        <div id="setup-ui" class="card">
            <h2 style="color: var(--primary);">ğŸ§ª åŒ–å­¸å¼ç²¾ç†Ÿæ¸¬é©— (100åˆ†åˆ¶)</h2>
            <div style="text-align:left; margin: 20px auto; max-width: 350px;">
                <label>ç­ç´šï¼š</label>
                <select id="user-class"><option value="801">801</option><option value="802">802</option><option value="803">803</option><option value="804">804</option><option value="805">805</option></select><br><br>
                <label>åº§è™Ÿï¼š</label>
                <div class="no-split">
                    <div><small>åä½æ•¸</small><br><select id="no-tens"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select></div>
                    <div><small>å€‹ä½æ•¸</small><br><select id="no-ones"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select></div>
                </div><br>
                <label>å§“åï¼š</label>
                <input type="text" id="user-name" placeholder="è¼¸å…¥å§“å">
            </div>
            <button onclick="startQuiz()" style="width:100%; padding:15px; background:var(--success); color:white; border:none; border-radius:8px; font-size:18px; cursor:pointer; font-weight:bold;">é–‹å§‹æŒ‘æˆ°</button>
        </div>

        <div id="quiz-ui" class="card" style="display:none;">
            <div class="progress-bar"><div id="progress-fill"></div></div>
            <div id="q-info" style="font-weight:bold; color:var(--secondary);"></div>
            <div class="q-text" id="q-content"></div>
            <div class="options-grid" id="options-area"></div>
            
            <div id="explanation-box">
                <div id="exp-title" style="font-weight:bold; margin-bottom:5px;"></div>
                <div id="exp-content"></div>
                <button onclick="goToNextQuestion()" style="margin-top:10px; padding:10px 25px; background:var(--secondary); color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">é€²å…¥ä¸‹ä¸€é¡Œ</button>
            </div>
        </div>

        <div id="result-ui" class="card" style="display:none;">
            <h2>æ¸¬é©—çµæŸ</h2>
            <h1 id="final-score" style="font-size:72px; color:var(--error);">0 åˆ†</h1>
            <p id="user-data-display"></p>
            <button onclick="location.reload()" style="padding:10px 20px; cursor:pointer; border-radius:5px;">é‡æ–°æŒ‘æˆ°</button>
        </div>
    </div>

    <div id="modal-valence" class="modal" onclick="closeModal('modal-valence')"><div class="modal-content"><img src="Atomic_valence.jpg"></div></div>
    <div id="modal-group" class="modal" onclick="closeModal('modal-group')"><div class="modal-content"><img src="atomic_group.jpg"></div></div>

    <script>
        const quizDB = [
            // 1-10 é¡Œï¼šæ¯é¡Œ 3 åˆ†
            { q: "CH3COOH", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "ç¤ºæ€§å¼", exp: "ç¤ºæ€§å¼æœƒè¡¨ç¾å‡ºç‰©è³ªçš„å®˜èƒ½åŸºï¼ŒCOOH ç‚ºç¾§åŸºï¼Œè¡¨ç¤ºå®ƒæ˜¯é†‹é…¸ã€‚", pts: 3 },
            { q: "C6H12O6", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "åˆ†å­å¼", exp: "åˆ†å­å¼è¡¨ç¾å‡ºåˆ†å­ä¸­åŸå­çš„å¯¦éš›ç¨®é¡èˆ‡çœŸå¯¦å€‹æ•¸ã€‚", pts: 3 },
            { q: "CH2O", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "å¯¦é©—å¼", exp: "å¯¦é©—å¼è¡¨ç¤ºåŸå­é–“çš„æœ€ç°¡å–®æ•´æ•¸æ¯”ã€‚è‘¡è„ç³–èˆ‡ç”²é†›çš„ç°¡å¼å‡ç‚º CH2Oã€‚", pts: 3 },
            { q: "H-O-H", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "çµæ§‹å¼", exp: "ä»¥çŸ­æ§“ï¼ˆåƒ¹éµï¼‰è¡¨ç¤ºåŸå­é–“éµçµæƒ…å½¢çš„åŒ–å­¸å¼ç¨±ç‚ºçµæ§‹å¼ã€‚", pts: 3 },
            { q: "C2H5OH", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "ç¤ºæ€§å¼", exp: "OH åŸºï¼ˆç¾¥åŸºï¼‰è¡¨ç¤ºå®ƒæ˜¯é…’ç²¾ï¼ˆä¹™é†‡ï¼‰ï¼Œé€™å±¬æ–¼ç¤ºæ€§å¼çš„è¡¨é”æ–¹å¼ã€‚", pts: 3 },
            { q: "O=C=O", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "çµæ§‹å¼", exp: "é¡¯ç¤ºå‡ºåŸå­æ’åˆ—ä½ç½®èˆ‡å–®é›™éµé—œä¿‚ï¼Œç‚ºçµæ§‹å¼ã€‚", pts: 3 },
            { q: "NH2", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "å¯¦é©—å¼", exp: "è¯èƒº(N2H4)çš„æœ€ç°¡æ•´æ•¸æ¯”ç‚º NH2ï¼Œæ•…ç‚ºå¯¦é©—å¼ã€‚", pts: 3 },
            { q: "C2H4O2", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "åˆ†å­å¼", exp: "é€™æ˜¯é†‹é…¸çš„åˆ†å­å¼ï¼Œè¡¨ç¾å‡ºæ‰€æœ‰åŸå­çš„çœŸå¯¦å€‹æ•¸ã€‚", pts: 3 },
            { q: "CH3OCH3", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "ç¤ºæ€§å¼", exp: "ä¸­é–“çš„ -O- (é†šåŸº)é¡¯ç¤ºäº†äºŒç”²é†šçš„ç‰¹æ€§ï¼Œç‚ºç¤ºæ€§å¼ã€‚", pts: 3 },
            { q: "C2H6", opts: ["å¯¦é©—å¼", "åˆ†å­å¼", "çµæ§‹å¼", "ç¤ºæ€§å¼"], ans: "åˆ†å­å¼", exp: "ä¹™çƒ·çš„çœŸå¯¦åŸå­å€‹æ•¸ï¼Œå±¬æ–¼åˆ†å­å¼ã€‚", pts: 3 },

            // 11-20 é¡Œï¼šæ¯é¡Œ 4 åˆ†
            { q: "ç¡«é…¸é‹", opts: ["AlSO4", "Al2SO4", "Al2(SO4)3", "Al(SO4)2"], ans: "Al2(SO4)3", exp: "é‹é›¢å­ç‚º +3ï¼Œç¡«é…¸æ ¹ç‚º -2ï¼Œäº¤å‰ç›¸ä¹˜å¾Œç‚º Al2(SO4)3ã€‚", pts: 4 },
            { q: "ç¢³é…¸æ°«éˆ‰ (å°è˜‡æ‰“)", opts: ["Na2CO3", "NaHCO3", "NaOH", "NaH"], ans: "NaHCO3", exp: "éˆ‰(+1)èˆ‡ç¢³é…¸æ°«æ ¹(-1)çµåˆï¼Œå½¢æˆ NaHCO3ã€‚", pts: 4 },
            { q: "é«˜éŒ³é…¸é‰€", opts: ["K2MnO4", "KMnO4", "KMn2O4", "K2MnO2"], ans: "KMnO4", exp: "é‰€(+1)èˆ‡é«˜éŒ³é…¸æ ¹(-1)çµåˆã€‚æ³¨æ„é«˜éŒ³é…¸æ ¹æ˜¯ç´«è‰²ä¾†æºã€‚", pts: 4 },
            { q: "æ°«æ°§åŒ–éˆ£ (ç†ŸçŸ³ç°)", opts: ["CaO", "CaOH", "Ca(OH)2", "Ca2OH"], ans: "Ca(OH)2", exp: "éˆ£(+2)èˆ‡æ°«æ°§åŒ–æ ¹(-1)çµåˆï¼ŒåŸå­åœ˜æ•¸é‡å¤§æ–¼1æ™‚é ˆåŠ æ‹¬è™Ÿã€‚", pts: 4 },
            { q: "ç¡é…¸é‰›", opts: ["PbNO3", "Pb2NO3", "Pb(NO3)2", "Pb(NO2)2"], ans: "Pb(NO3)2", exp: "é‰›é›¢å­å¸¸è¦‹ç‚º +2ï¼Œç¡é…¸æ ¹ç‚º -1ï¼Œæ•…ç‚º Pb(NO3)2ã€‚", pts: 4 },
            { q: "æ°¯åŒ–éŠ¨", opts: ["NH3Cl", "NH4Cl", "NH2Cl", "NCl"], ans: "NH4Cl", exp: "éŠ¨æ ¹(NH4+)æ˜¯å”¯ä¸€çš„é™½é›¢å­åŸå­åœ˜ï¼Œèˆ‡æ°¯é›¢å­çµåˆæˆ NH4Clã€‚", pts: 4 },
            { q: "é‰»é…¸é‰€", opts: ["KCrO4", "K2CrO4", "KCr2O7", "K2Cr2O7"], ans: "K2CrO4", exp: "é‰»é…¸æ ¹ç‚º CrO4(2-)ï¼Œæ•…éœ€è¦å…©å€‹é‰€é›¢å­å¹³è¡¡é›»è·ã€‚", pts: 4 },
            { q: "é‡é‰»é…¸é‰€", opts: ["K2CrO4", "K2Cr2O7", "KCrO4", "KCr2O7"], ans: "K2Cr2O7", exp: "é‡é‰»é…¸æ ¹(äºŒé‰»é…¸æ ¹)ç‚º Cr2O7(2-)ï¼Œé¡è‰²ç‚ºæ©˜ç´…è‰²ã€‚", pts: 4 },
            { q: "ç¡«åŒ–æ°«", opts: ["HS", "H2S", "H2SO4", "H2SO3"], ans: "H2S", exp: "ç¡«é›¢å­ç‚º -2ï¼Œæ°«é›¢å­ç‚º +1ï¼Œçµåˆå¾Œç‚º H2Sã€‚", pts: 4 },
            { q: "ç£·é…¸", opts: ["HPO4", "H2PO4", "H3PO4", "H3PO3"], ans: "H3PO4", exp: "ç£·é…¸æ ¹ç‚º PO4(3-)ï¼Œéœ€è¦ä¸‰å€‹æ°«é›¢å­å¹³è¡¡ã€‚", pts: 4 },

            // 21-30 é¡Œï¼šæ¯é¡Œ 3 åˆ†
            { q: "Na2CO3", opts: ["ç¢³é…¸éˆ‰ (è˜‡æ‰“)", "ç¢³é…¸æ°«éˆ‰", "æ°«æ°§åŒ–éˆ‰", "æ°¯åŒ–éˆ‰"], ans: "ç¢³é…¸éˆ‰ (è˜‡æ‰“)", exp: "ä¿—ç¨±è˜‡æ‰“æˆ–æ´—æ»Œé¹¼ï¼Œæ˜“æº¶æ–¼æ°´ã€‚", pts: 3 },
            { q: "CaO", opts: ["ç¢³é…¸éˆ£", "æ°«æ°§åŒ–éˆ£", "æ°§åŒ–éˆ£ (ç”ŸçŸ³ç°)", "ç¡«é…¸éˆ£"], ans: "æ°§åŒ–éˆ£ (ç”ŸçŸ³ç°)", exp: "ä¿—ç¨±ç”ŸçŸ³ç°ï¼Œèˆ‡æ°´åæ‡‰æœƒæ”¾å‡ºå¤§é‡çš„ç†±ã€‚", pts: 3 },
            { q: "HCl", opts: ["ç¡«é…¸", "ç¡é…¸", "æ°«æ°¯é…¸ (é¹½é…¸)", "é†‹é…¸"], ans: "æ°«æ°¯é…¸ (é¹½é…¸)", exp: "æ°¯åŒ–æ°«æ°£é«”çš„æ°´æº¶æ¶²å³ç‚ºé¹½é…¸ã€‚", pts: 3 },
            { q: "H2O2", opts: ["æ°´", "éæ°§åŒ–æ°« (é›™æ°§æ°´)", "è‡­æ°§", "äºŒæ°§åŒ–æ°«"], ans: "éæ°§åŒ–æ°« (é›™æ°§æ°´)", exp: "å¯¦é©—å®¤è£½æ°§å¸¸ç”¨çš„è©¦åŠ‘ï¼ŒåŠ å‚¬åŒ–åŠ‘å¯åˆ†è§£ã€‚", pts: 3 },
            { q: "CuSO4", opts: ["ç¡«é…¸éŠ…", "ç¢³é…¸éŠ…", "ç¡é…¸éŠ…", "æ°¯åŒ–éŠ…"], ans: "ç¡«é…¸éŠ…", exp: "ç„¡æ°´æ™‚ç‚ºç™½è‰²ï¼Œé‡æ°´è®Šè—è‰²ï¼Œå¸¸ç”¨æ–¼æª¢é©—æ°´çš„å­˜åœ¨ã€‚", pts: 3 },
            { q: "KNO3", opts: ["ç¡é…¸é‰€", "äºç¡é…¸é‰€", "ç¢³é…¸é‰€", "ç¡«é…¸é‰€"], ans: "ç¡é…¸é‰€", exp: "å¼·æ°§åŒ–åŠ‘ï¼Œå¸¸ç”¨æ–¼è£½é€ ç«è—¥ã€‚", pts: 3 },
            { q: "NH3", opts: ["éŠ¨æ ¹", "æ°¨æ°£", "ç¡é…¸", "æ°¯åŒ–éŠ¨"], ans: "æ°¨æ°£", exp: "å…·åˆºé¼»è‡­å‘³ï¼Œæ˜“æº¶æ–¼æ°´çš„å¼±é¹¼æ€§æ°£é«”ã€‚", pts: 3 },
            { q: "CH4", opts: ["ä¹™çƒ·", "ç”²çƒ·", "ä¸™çƒ·", "äºŒæ°§åŒ–ç¢³"], ans: "ç”²çƒ·", exp: "å¤©ç„¶æ°£èˆ‡æ²¼æ°£çš„ä¸»è¦æˆåˆ†ã€‚", pts: 3 },
            { q: "AgNO3", opts: ["ç¡é…¸éŠ€", "ç¡«é…¸éŠ€", "ç¢³é…¸éŠ€", "æ°§åŒ–éŠ€"], ans: "ç¡é…¸éŠ€", exp: "ç…§å…‰æ˜“åˆ†è§£ï¼Œé ˆå„²å­˜æ–¼æ·±è‰²ç“¶ä¸­ã€‚", pts: 3 },
            { q: "Mg(OH)2", opts: ["æ°§åŒ–é‚", "æ°«æ°§åŒ–é‚", "ç¡«é…¸é‚", "ç¢³é…¸é‚"], ans: "æ°«æ°§åŒ–é‚", exp: "å¸¸è¦‹çš„èƒƒè—¥æˆåˆ†ï¼Œå…·å¼±é¹¼æ€§å¯ä¸­å’Œèƒƒé…¸ã€‚", pts: 3 }
        ];

        let currentQ = 0, score = 0, user = {}, details = [];
        const script_url = "https://script.google.com/macros/s/AKfycbztA9Vt-JN4BxvoDP-sYJTP9ran6KE6fZj0ooYSrOgLaKafqH1SHGTLKypL10Vof28V_g/exec";

        function openModal(id) { document.getElementById(id).style.display = "block"; }
        function closeModal(id) { document.getElementById(id).style.display = "none"; }

        function startQuiz() {
            const tens = document.getElementById('no-tens').value, ones = document.getElementById('no-ones').value;
            user = { class: document.getElementById('user-class').value, no: parseInt(tens)*10+parseInt(ones), name: document.getElementById('user-name').value };
            if(!user.name) return alert("è«‹è¼¸å…¥å§“åï¼");
            document.getElementById('setup-ui').style.display='none';
            document.getElementById('quiz-ui').style.display='block';
            loadQuestion();
        }

        function loadQuestion() {
            const q = quizDB[currentQ];
            document.getElementById('progress-fill').style.width = ((currentQ + 1) / 30) * 100 + "%";
            document.getElementById('q-info').innerText = `ç¬¬ ${currentQ + 1} / 30 é¡Œ (æ­¤é¡Œ ${q.pts} åˆ†)`;
            document.getElementById('q-content').innerHTML = q.q.replace(/(\d+)/g, '<span class="sub">$1</span>');
            const area = document.getElementById('options-area'); area.innerHTML = "";
            document.getElementById('explanation-box').style.display = "none";
            
            q.opts.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = opt.replace(/(\d+)/g, '<span class="sub">$1</span>');
                btn.onclick = () => checkAnswer(opt, btn);
                area.appendChild(btn);
            });
        }

        function checkAnswer(selected, btn) {
            const q = quizDB[currentQ];
            const box = document.getElementById('explanation-box');
            document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
            
            if (selected === q.ans) {
                score += q.pts;
                details.push(1); // ç´€éŒ„æ­£ç¢º
                document.getElementById('exp-title').innerText = "âœ… å›ç­”æ­£ç¢ºï¼";
                box.className = "exp-correct";
            } else {
                details.push(0); // ç´€éŒ„éŒ¯èª¤
                document.getElementById('exp-title').innerText = "âŒ å›ç­”éŒ¯èª¤...";
                box.className = "exp-wrong";
            }
            document.getElementById('exp-content').innerHTML = `æ­£ç¢ºç­”æ¡ˆç‚ºï¼š<b>${q.ans}</b><br><small>${q.exp}</small>`;
            box.style.display = "block";
        }

        function goToNextQuestion() {
            currentQ++;
            if (currentQ < 30) loadQuestion(); else finish();
        }

        function finish() {
            document.getElementById('quiz-ui').style.display='none';
            document.getElementById('result-ui').style.display='block';
            document.getElementById('final-score').innerText = score + " åˆ†";
            document.getElementById('user-data-display').innerText = `${user.name} (${user.class}ç­ ${user.no}è™Ÿ)`;
            
            // å‚³é€å®Œæ•´è³‡æ–™è‡³è©¦ç®—è¡¨
            const finalDetails = details.join(",");
            const params = `class=${user.class}&no=${user.no}&name=${encodeURIComponent(user.name)}&score=${score}&details=${finalDetails}`;
            
            fetch(`${script_url}?${params}`, { method: 'POST', mode: 'no-cors' });
        }
    </script>
</body>
</html>