<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸå­é‡ã€åˆ†å­é‡ã€è«è€³ - é¾é’åºœè€å¸«</title>
    <script>
        window.MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']] } };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        :root { --primary: #2980b9; --success: #27ae60; --error: #e74c3c; --dark: #2c3e50; --bg: #f4f7f6; --banner: #34495e; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; }
        .header-banner { background: var(--banner); color: white; padding: 20px; text-align: center; position: fixed; width: 100%; top: 0; z-index: 1100; box-shadow: 0 2px 5px rgba(0,0,0,0.2); height: 30px; line-height: 30px; }
        .header-banner h1 { margin: 0; letter-spacing: 5px; font-size: 24px; }
        .container { display: flex; margin-top: 70px; }
        
        /* å´é‚Šæ¬„ä¿®æ­£ï¼šæŒ‰éˆ•ä¾åºæ’åˆ—ï¼Œä¸å¼·åˆ¶ç½®åº• */
        .sidebar { width: 220px; background: var(--dark); padding: 40px 15px; height: calc(100vh - 70px); position: fixed; top: 70px; display: flex; flex-direction: column; gap: 12px; z-index: 1000; overflow-y: auto; }
        .sidebar button { padding: 15px; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; text-align: left; font-size: 15px; transition: 0.3s; width: 100%; flex-shrink: 0; }
        .sidebar button.active { background: var(--primary); border: 2px solid white; }
        
        .main-content { margin-left: 250px; padding: 40px; flex-grow: 1; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        .quiz-card { background: white; width: 100%; max-width: 650px; padding: 35px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); text-align: center; }
        .form-group { text-align: left; margin-bottom: 20px; }
        select, input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        .seat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .calc-input { width: 85px; text-align: center; border: 1px solid #999; border-radius: 4px; padding: 6px; }
        #feedback-box { display: none; margin-top: 20px; padding: 20px; border-radius: 10px; text-align: left; }
        .fb-correct { background: #d4edda; border: 2px solid #28a745; color: #155724; }
        .fb-wrong { background: #f8d7da; border: 2px solid #dc3545; color: #721c24; }
        .review-list { text-align: left; margin-top: 20px; padding: 15px; background: #fffefe; border-radius: 8px; border: 1px solid #e0e0e0; }
    </style>
</head>
<body>

<div class="header-banner"><h1>åŸå­é‡ã€åˆ†å­é‡ã€è«è€³è©•é‡ç³»çµ±</h1></div>

<div class="container">
    <div class="sidebar">
        <button style="background:#9b59b6;" onclick="window.open('Atomic_molecular.pdf', '_blank')">ğŸ“„ é–±è®€è¬›ç¾©</button>
        <button id="btn-0" class="active" onclick="switchUnit(0)">âœï¸ åŸå­é‡èˆ‡åˆ†å­é‡</button>
        <button id="btn-1" onclick="switchUnit(1)">âœï¸ è«è€³èˆ‡ç²’å­æ•¸</button>
        <button id="btn-2" onclick="switchUnit(2)">âœï¸ è³ªé‡èˆ‡è«è€³è½‰æ›</button>
        <button style="background:#e67e22;" onclick="location.href='../index.html'">ğŸ  å›é¦–é </button>
    </div>

    <div class="main-content">
        <div id="login-box" class="quiz-card">
            <h2 id="unit-title">ç›®å‰å–®å…ƒï¼šåŸå­é‡èˆ‡åˆ†å­é‡</h2>
            <div class="form-group"><label>ç­ç´šï¼š</label>
                <select id="user-class"><option value="801">801</option><option value="802">802</option><option value="803">803</option><option value="804">804</option><option value="805">805</option></select>
            </div>
            <div class="form-group"><label>åº§è™Ÿï¼š</label>
                <div class="seat-grid">
                    <select id="no-ten"><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option></select>
                    <select id="no-one"><option value="">å€‹ä½</option><option value="0">0</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option></select>
                </div>
            </div>
            <div class="form-group"><label>å§“åï¼š</label><input type="text" id="user-name" placeholder="è«‹è¼¸å…¥å§“å"></div>
            <button onclick="startQuiz()" style="width:100%; padding:15px; background:var(--success); color:white; border:none; border-radius:8px; font-weight:bold; cursor:pointer;">é–‹å§‹æ¸¬é©—</button>
        </div>

        <div id="quiz-box" class="quiz-card" style="display:none;">
            <div id="q-header" style="font-weight:bold; color:var(--primary); margin-bottom:15px;"></div>
            <div id="q-content"></div>
            <div id="feedback-box">
                <div id="fb-title" style="font-weight:bold;"></div>
                <div id="fb-text" style="margin: 10px 0;"></div>
                <button onclick="nextQ()" style="padding:10px 25px; background:var(--primary); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">ä¸‹ä¸€é¡Œ</button>
            </div>
        </div>

        <div id="result-box" class="quiz-card" style="display:none;">
            <h2>è©•é‡çµç®—</h2>
            <h1 id="score-display" style="font-size:72px; color:var(--error); margin: 20px 0;">0</h1>
            <div id="error-review" class="review-list" style="display:none;">
                <h4 style="margin-top:0;">ğŸ’¡ éŒ¯é¡Œé‡é»è¤‡ç¿’ï¼š</h4>
                <ul id="error-items"></ul>
            </div>
            <p id="upload-status" style="font-weight:bold; color:var(--primary); margin-top:20px;">è³‡æ–™ç™»éŒ„ä¸­...</p>
            <button onclick="location.reload()" style="padding:12px 25px; border-radius:8px; cursor:pointer;">é‡æ–°æŒ‘æˆ°</button>
        </div>
    </div>
</div>

<script>
    const script_url = "https://script.google.com/macros/s/AKfycbzXkjCD4jdQRzLPrfYahplJ4PaNQi42_glFiugwvO9VCoydokImjFq01yGyl76QxkQ/exec";
    const allUnits = [
        {
            name: "åŸå­é‡èˆ‡åˆ†å­é‡",
            questions: [
                {type:"radio", q:"é—œæ–¼åŸå­é‡çš„æ¯”è¼ƒæ¨™æº–ï¼Œç›®å‰åœ‹éš›å…¬èªæ˜¯ä»¥å“ªä¸€ç¨®åŸå­ç‚ºåŸºæº–ï¼Ÿ", o:["æ°«-1","æ°§-16","ç¢³-12","æ°®-14"], a:2, p:3, e:"ç›®å‰åœ‹éš›ä»¥ç¢³-12 = 12.0000 ç‚ºæ¨™æº–ã€‚"},
                {type:"radio", q:"åŸå­é‡æ˜¯ç§‘å­¸å®¶è¨‚å‡ºçš„ã€Œç›¸å°è³ªé‡ã€ï¼Œå…¶å–®ä½ç‚ºä½•ï¼Ÿ", o:["å…¬å…‹(g)","å…¬æ–¤(kg)","æ²’æœ‰å–®ä½","è«è€³(mole)"], a:2, p:3, e:"åŸå­é‡æ˜¯æ¯”è¼ƒæ•¸å€¼ï¼Œå› æ­¤æ²’æœ‰å–®ä½ã€‚"},
                {type:"radio", q:"è‹¥åŸå­é‡çš„æ¨™æº–ç”±ç¢³-12æ”¹ç‚ºç¢³-24ï¼Œå‰‡1å€‹æ°§åŸå­çš„ã€ŒçœŸå¯¦è³ªé‡ã€æœƒå¦‚ä½•ï¼Ÿ", o:["è®Šé‡","è®Šè¼•","ä¸è®Š","è®Šç‚º2å€"], a:2, p:3, e:"æ¨™æº–å®šç¾©æ”¹è®Šä¸å½±éŸ¿åŸå­çœŸå¯¦çš„ç‰©ç†è³ªé‡ã€‚"},
                {type:"mw", q:"è¨ˆç®— äºŒæ°§åŒ–ç¢³ (\\(CO_2\\)) åˆ†å­é‡ï¼š", s:"12 + 16 \\(\\times\\) ", sa:2, ans:44, p:4, e:"\\(12 + 16 \\times 2 = 44\\)ã€‚"},
                {type:"mw", q:"è¨ˆç®— æ°´ (\\(H_2O\\)) åˆ†å­é‡ï¼š", s:"1 \\(\\times\\) 2 + ", sa:16, ans:18, p:4, e:"\\(1 \\times 2 + 16 = 18\\)ã€‚"},
                {type:"mw", q:"è¨ˆç®— æ°«æ°§åŒ–éˆ‰ (NaOH) åˆ†å­é‡ï¼š", s:"23 + 16 + ", sa:1, ans:40, p:4, e:"\\(23 + 16 + 1 = 40\\)ã€‚"},
                {type:"mw", q:"è¨ˆç®— ç¡«é…¸ (\\(H_2SO_4\\)) åˆ†å­é‡ï¼š", s:"1 \\(\\times\\) 2 + 32 + 16 \\(\\times\\) ", sa:4, ans:98, p:4, e:"\\(2 + 32 + 64 = 98\\)ã€‚"},
                {type:"mw", q:"è¨ˆç®— è‘¡è„ç³– (\\(C_6H_{12}O_6\\)) åˆ†å­é‡ï¼š", s:"12 \\(\\times\\) 6 + 1 \\(\\times\\) 12 + 16 \\(\\times\\) ", sa:6, ans:180, p:4, e:"\\(72 + 12 + 96 = 180\\)ã€‚"}
            ]
        },
        {
            name: "è«è€³èˆ‡ç²’å­æ•¸",
            questions: [
                {type:"radio", q:"1 è«è€³çš„ç‰©è³ªæ‰€å«ç²’å­æ•¸é‡å¤§ç´„æ˜¯å¤šå°‘å€‹ï¼Ÿ", o:["\\(6 \\times 10^{22}\\)","\\(6 \\times 10^{23}\\)","\\(1.2 \\times 10^{23}\\)"], a:1, p:3, e:"äºä½›åŠ å¾·ç¾…æ•¸ç´„ç‚º \\(6 \\times 10^{23}\\)ã€‚"},
                {type:"radio", q:"0.5 è«è€³çš„æ°´åˆ†å­ (\\(H_2O\\)) å«æœ‰å¹¾è«è€³åŸå­ï¼Ÿ", o:["0.5","1.0","1.5"], a:2, p:3, e:"\\(0.5 \\times 3 = 1.5\\) è«è€³åŸå­ã€‚"},
                {type:"mole", q:"å·²çŸ¥ \\(1.2 \\times 10^{24}\\) å€‹æ°´åˆ†å­", l:["è«è€³æ•¸","æ•¸é‡ (\\(\\times 6 \\times 10^{23}\\))"], a:[2,2], p:5, e:"\\(1.2 \\times 10^{24} = 2 \\times 6 \\times 10^{23}\\)ã€‚"},
                {type:"radio", q:"1 è«è€³äºŒæ°§åŒ–ç¢³ (\\(CO_2\\)) å«æœ‰å¤šå°‘è«è€³æ°§åŸå­ï¼Ÿ", o:["1","2","3"], a:1, p:3, e:"ä¸€å€‹ \\(CO_2\\) æœ‰å…©å€‹æ°§åŸå­ã€‚"},
                {type:"mole", q:"å·²çŸ¥ 0.5 è«è€³çš„ç”²çƒ· (\\(CH_4\\))", l:["åˆ†å­æ•¸é‡ (\\(\\times 6 \\times 10^{23}\\))","ç¸½åŸå­è«è€³æ•¸"], a:[0.5,2.5], p:5, e:"\\(0.5 \\times 5 = 2.5\\) è«è€³ã€‚"},
                {type:"radio", q:"ä¸‹åˆ—ä½•è€…å«æœ‰æœ€å¤šæ•¸é‡çš„åŸå­ï¼Ÿ", o:["1è«è€³\\(O_2\\)","1è«è€³\\(H_2O\\)","1è«è€³\\(CH_4\\)"], a:2, p:3, e:"æ¯”è¼ƒåŸå­æ•¸ï¼š2, 3, 5ã€‚"},
                {type:"radio", q:"\\(3 \\times 10^{23}\\) å€‹æ°§åˆ†å­ (\\(O_2\\)) ç­‰æ–¼å¤šå°‘è«è€³ï¼Ÿ", o:["0.5 è«è€³","1 è«è€³","2 è«è€³"], a:0, p:3, e:"\\(3 \\times 10^{23} / 6 \\times 10^{23} = 0.5\\)ã€‚"},
                {type:"mole", q:"å·²çŸ¥ 2 è«è€³çš„æ°§æ°£ (\\(O_2\\))", l:["åˆ†å­æ•¸é‡ (\\(\\times 6 \\times 10^{23}\\))","æ°§åŸå­è«è€³æ•¸"], a:[2,4], p:5, e:"2è«è€³åˆ†å­æœ‰4è«è€³åŸå­ã€‚"}
            ]
        },
        {
            name: "è³ªé‡èˆ‡è«è€³è½‰æ›",
            questions: [
                {type:"mole", q:"å·²çŸ¥ 36 å…¬å…‹çš„æ°´ (\\(H_2O=18\\))", l:["è«è€³æ•¸","æ•¸é‡ (\\(\\times 6 \\times 10^{23}\\))"], a:[2,2], p:5, e:"\\(36 / 18 = 2\\) è«è€³ã€‚"},
                {type:"radio", q:"ç›¸åŒè³ªé‡çš„ \\(H_2O\\) èˆ‡ \\(CO_2\\)ï¼Œä½•è€…åˆ†å­æ•¸è¼ƒå¤šï¼Ÿ", o:["\\(H_2O\\)","\\(CO_2\\)","ä¸€æ¨£å¤š"], a:0, p:3, e:"åŒæ¨£è³ªé‡ä¸‹ï¼Œåˆ†å­é‡è¶Šå°å‰‡è«è€³æ•¸è¶Šå¤šã€‚"},
                {type:"mole", q:"å·²çŸ¥ 88 å…¬å…‹çš„äºŒæ°§åŒ–ç¢³ (\\(CO_2=44\\))", l:["è«è€³æ•¸","æ•¸é‡ (\\(\\times 6 \\times 10^{23}\\))"], a:[2,2], p:5, e:"\\(88 / 44 = 2\\) è«è€³ã€‚"},
                {type:"mole", q:"å·²çŸ¥ 3 è«è€³çš„ç¢³åŸå­ (C=12)", l:["è³ªé‡(g)","æ•¸é‡ (\\(\\times 6 \\times 10^{23}\\))"], a:[36,3], p:5, e:"\\(3 \\times 12 = 36\\) gã€‚"},
                {type:"mole", q:"å·²çŸ¥ 49 å…¬å…‹çš„ç¡«é…¸ (\\(H_2SO_4=98\\))", l:["è«è€³æ•¸","æ•¸é‡ (\\(\\times 6 \\times 10^{23}\\))"], a:[0.5,0.5], p:5, e:"\\(49 / 98 = 0.5\\) è«è€³ã€‚"},
                {type:"radio", q:"18 å…¬å…‹çš„æ°´å«æœ‰å¤šå°‘å…¬å…‹çš„æ°«å…ƒç´ ï¼Ÿ(H=1, O=16)", o:["1g","2g","16g"], a:1, p:3, e:"\\(H_2O\\) ä¸­ H ä½” 2/18ã€‚"},
                {type:"mole", q:"å·²çŸ¥ \\(3 \\times 10^{23}\\) å€‹æ°«æ°£ (\\(H_2=2\\))", l:["è«è€³æ•¸","è³ªé‡(g)"], a:[0.5,1], p:5, e:"0.5 è«è€³æ°«æ°£é‡ 1gã€‚"},
                {type:"mole", q:"å·²çŸ¥ 2 è«è€³äºŒæ°§åŒ–ç¢³ (\\(CO_2=44\\))", l:["è³ªé‡(g)","æ•¸é‡ (\\(\\times 6 \\times 10^{23}\\))"], a:[88,2], p:5, e:"\\(2 \\times 44 = 88\\) gã€‚"},
                {type:"radio", q:"4å…¬å…‹çš„æ°«æ°£(\\(H_2\\))èˆ‡32å…¬å…‹çš„æ°§æ°£(\\(O_2\\))ï¼Œä½•è€…è«è€³æ•¸è¼ƒå¤§ï¼Ÿ", o:["æ°«æ°£","æ°§æ°£","ä¸€æ¨£å¤§"], a:0, p:3, e:"æ°«æ°£ 2 è«è€³ï¼Œæ°§æ°£ 1 è«è€³ã€‚"}
            ]
        }
    ];

    let currentUnit = 0, currentIdx = 0, score = 0, detailLog = [], errorNotes = [];

    function switchUnit(idx) {
        currentUnit = idx;
        document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
        document.getElementById(`btn-${idx}`).classList.add('active');
        document.getElementById('unit-title').innerText = `ç›®å‰å–®å…ƒï¼š${allUnits[idx].name}`;
    }

    function startQuiz() {
        if(!document.getElementById('user-name').value || document.getElementById('no-one').value === "") return alert("è«‹è¼¸å…¥åº§è™Ÿèˆ‡å§“å");
        document.getElementById('login-box').style.display='none';
        document.getElementById('quiz-box').style.display='block';
        currentIdx = 0; score = 0; detailLog = []; errorNotes = [];
        loadQ();
    }

    function loadQ() {
        const q = allUnits[currentUnit].questions[currentIdx];
        document.getElementById('q-header').innerText = `ã€${allUnits[currentUnit].name}ã€‘ é¡Œè™Ÿï¼š${currentIdx+1} / ${allUnits[currentUnit].questions.length}`;
        document.getElementById('feedback-box').style.display = 'none';
        let html = `<div class="question-text">${q.q}</div>`;
        if(q.type === "radio") {
            q.o.forEach((opt, i) => html += `<button class="option-btn" onclick="checkRadio(${i})" style="display:block; width:100%; margin:10px 0;">${String.fromCharCode(65+i)}. ${opt}</button>`);
        } else if(q.type === "mw") {
            html += `<div class="calc-area">æ­¥é©Ÿï¼š${q.s} <input type="number" id="ans-s" class="calc-input"></div>æœ€å¾Œç­”æ¡ˆï¼š<input type="number" id="ans-a" class="calc-input"><button class="option-btn" onclick="checkMW()" style="margin-left:10px; width:80px; text-align:center; display:inline-block;">é€å‡º</button>`;
        } else if(q.type === "mole") {
            html += `<div class="calc-area">${q.l[0]}ï¼š<input type="number" id="ans-1" class="calc-input"><br><br>${q.l[1]}ï¼š<input type="number" id="ans-2" class="calc-input"></div><button class="option-btn" onclick="checkMole()" style="width:100%; text-align:center;">é€å‡ºç­”æ¡ˆ</button>`;
        }
        document.getElementById('q-content').innerHTML = html;
        if(window.MathJax) MathJax.typesetPromise();
    }

    function showFB(ok, txt) {
        const fb = document.getElementById('feedback-box');
        fb.style.display = 'block';
        fb.className = ok ? "fb-correct" : "fb-wrong";
        document.getElementById('fb-title').innerText = ok ? "âœ… å›ç­”æ­£ç¢º" : "âŒ å›ç­”éŒ¯èª¤";
        document.getElementById('fb-text').innerHTML = txt;
        detailLog.push(ok ? "å°" : "éŒ¯");
        if(!ok) errorNotes.push(`é¡Œè™Ÿ ${currentIdx+1}ï¼š${allUnits[currentUnit].questions[currentIdx].q.substring(0,12)}...`);
        document.querySelectorAll('.option-btn').forEach(b => b.disabled = true);
        if(window.MathJax) MathJax.typesetPromise();
    }

    function checkRadio(idx) {
        const q = allUnits[currentUnit].questions[currentIdx];
        const ok = (idx === q.a); if(ok) score += q.p;
        showFB(ok, `æ­£ç¢ºç­”æ¡ˆï¼š${String.fromCharCode(65+q.a)}. ${q.o[q.a]}<br>è§£æï¼š${q.e}`);
    }

    function checkMW() {
        const q = allUnits[currentUnit].questions[currentIdx], s = parseFloat(document.getElementById('ans-s').value), a = parseFloat(document.getElementById('ans-a').value);
        const ok = (s === q.sa && a === q.ans); if(ok) score += q.p;
        showFB(ok, `æ­£ç¢ºï¼šæ­¥é©Ÿ ${q.sa}ï¼Œç­”æ¡ˆ ${q.ans}`);
    }

    function checkMole() {
        const q = allUnits[currentUnit].questions[currentIdx], v1 = parseFloat(document.getElementById('ans-1').value), v2 = parseFloat(document.getElementById('ans-2').value);
        const ok = (v1 === q.a[0] && v2 === q.a[1]); if(ok) score += q.p;
        showFB(ok, `æ­£ç¢ºï¼š${q.l[0]}=${q.a[0]}, ${q.l[1]}=${q.a[1]}`);
    }

    function nextQ() {
        currentIdx++;
        if(currentIdx < allUnits[currentUnit].questions.length) loadQ();
        else upload();
    }

    function upload() {
        document.getElementById('quiz-box').style.display='none';
        document.getElementById('result-box').style.display='block';
        document.getElementById('score-display').innerText = score;
        if(errorNotes.length > 0) {
            document.getElementById('error-review').style.display = 'block';
            document.getElementById('error-items').innerHTML = errorNotes.map(n => `<li>${n}</li>`).join("");
        }
        const seatNo = (parseInt(document.getElementById('no-ten').value) * 10 + parseInt(document.getElementById('no-one').value)).toString().padStart(2, '0');
        const params = new URLSearchParams({ quiz: allUnits[currentUnit].name, class: document.getElementById('user-class').value, no: seatNo, name: document.getElementById('user-name').value, score: score, details: detailLog.join(",") });
        fetch(`${script_url}?${params.toString()}`, { method: 'GET', mode: 'no-cors' }).then(() => document.getElementById('upload-status').innerText = "âœ… æˆç¸¾å·²ç™»éŒ„");
    }
</script>
</body>
</html>