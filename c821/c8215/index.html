<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ‹ä¸­ç†åŒ–ï¼šåŒ–å­¸è¨ˆé‡æŒ‘æˆ°è³½</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --error-color: #c0392b;
            --bg-color: #f4f7f6;
            --sidebar-width: 240px;
        }

        body {
            font-family: "Microsoft JhengHei", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            min-height: 100vh;
        }

        /* --- Sidebar Styles --- */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--primary-color);
            color: white;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .nav-btn {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            margin-bottom: 10px;
            text-decoration: none;
            color: #ecf0f1;
            border-radius: 8px;
            transition: background 0.3s;
            font-size: 1rem;
        }

        .nav-btn:hover {
            background-color: var(--secondary-color);
            color: white;
        }

        .nav-btn.active {
            background-color: var(--accent-color);
            color: white;
            font-weight: bold;
        }

        .nav-icon {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        /* --- Main Content Wrapper --- */
        .main-wrapper {
            margin-left: var(--sidebar-width);
            width: calc(100% - var(--sidebar-width));
            display: flex;
            justify-content: center;
            padding: 30px;
            box-sizing: border-box;
            min-height: 100vh; /* Ensure full height */
            align-items: flex-start; /* Align to top */
        }

        /* --- Quiz Container --- */
        .container {
            background: white;
            width: 100%;
            max-width: 800px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
            /* ä¿®æ­£ï¼šç§»é™¤ height fit-contentï¼Œç¢ºä¿æœ‰æœ€å°é«˜åº¦ */
            min-height: 400px; 
        }

        header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }

        header h1 { margin: 0; font-size: 1.5rem; }

        /* --- ä¿®æ­£å¾Œçš„ç™»å…¥ç•«é¢æ¨£å¼ --- */
        .login-screen {
            /* ä¿®æ­£é‡é»ï¼šç§»é™¤ absoluteï¼Œæ”¹ç‚ºç›¸å°å®šä½ï¼Œé¿å…é«˜åº¦å¡Œé™· */
            position: relative; 
            width: 100%;
            background: white;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            box-sizing: border-box;
            min-height: 300px; /* çµ¦äºˆæœ€å°é«˜åº¦ */
        }

        .login-form {
            width: 100%;
            max-width: 400px;
        }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--primary-color); }
        .form-control { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; box-sizing: border-box; background-color: #fff; }
        .seat-container { display: flex; gap: 10px; }
        .seat-select { flex: 1; }

        /* Quiz UI Elements */
        .progress-bar { height: 6px; background-color: #e0e0e0; width: 100%; }
        .progress-fill { height: 100%; background-color: var(--accent-color); width: 0%; transition: width 0.3s ease; }
        .quiz-content { padding: 30px; flex-grow: 1; display: none; }
        
        .question-tag { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; margin-bottom: 10px; }
        .tag-basic { background-color: #e8f6f3; color: #1abc9c; }
        .tag-advanced { background-color: #fdedec; color: #e74c3c; }
        
        .question-text { font-size: 1.2rem; margin-bottom: 25px; line-height: 1.6; }
        .options-grid { display: grid; gap: 15px; }
        
        .option-btn {
            background: white; border: 2px solid #e0e0e0; padding: 15px; border-radius: 8px;
            text-align: left; cursor: pointer; font-size: 1rem; transition: all 0.2s;
        }
        .option-btn:hover:not(.disabled) { border-color: var(--accent-color); background-color: #f0f8ff; }
        .option-btn.selected { border-color: var(--accent-color); background-color: #e1f0fa; }
        .option-btn.correct { border-color: var(--success-color); background-color: #d4efdf; color: #0b5345; }
        .option-btn.wrong { border-color: var(--error-color); background-color: #fadbd8; color: #78281f; }
        .option-btn.disabled { cursor: not-allowed; opacity: 0.7; }

        .feedback-section { margin-top: 25px; padding: 20px; border-radius: 8px; display: none; }
        .feedback-correct { background-color: #d4efdf; border-left: 5px solid var(--success-color); }
        .feedback-wrong { background-color: #fadbd8; border-left: 5px solid var(--error-color); }

        .footer-controls { padding: 20px 30px; border-top: 1px solid #eee; display: none; justify-content: space-between; align-items: center; }
        
        .btn { padding: 10px 25px; border: none; border-radius: 5px; font-size: 1rem; cursor: pointer; font-weight: bold; transition: opacity 0.2s; }
        .btn-submit { background-color: var(--accent-color); color: white; }
        .btn-next { background-color: var(--primary-color); color: white; display: none; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .result-screen { display: none; text-align: center; padding: 40px; }
        .score-circle { width: 150px; height: 150px; background-color: var(--accent-color); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; font-weight: bold; margin: 0 auto 20px; }
        sub { font-size: 0.7em; }
        
        /* Loading Overlay */
        .loading-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9);
            display: none; justify-content: center; align-items: center;
            flex-direction: column; z-index: 200;
        }
        .spinner {
            border: 5px solid #f3f3f3; border-top: 5px solid var(--accent-color);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Responsive Design for Mobile */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
                padding: 10px 15px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            }

            .sidebar-title { 
                margin: 0; 
                border: none; 
                padding: 0; 
                font-size: 1.2rem;
                margin-right: 10px;
                display: none;
            }

            .sidebar-nav {
                display: flex;
                gap: 5px;
                width: 100%;
                justify-content: space-around;
            }

            .nav-btn {
                margin: 0;
                padding: 8px;
                font-size: 0.9rem;
                text-align: center;
                flex: 1;
                justify-content: center;
            }

            .nav-icon { margin-right: 5px; }

            .main-wrapper {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }
        }
    </style>
</head>
<body>

    <nav class="sidebar">
        <div class="sidebar-title">ç†åŒ–æ•™å®¤</div>
        <div class="sidebar-nav">
            <a href="Chemometrics.pdf" target="_blank" class="nav-btn">
                <span class="nav-icon">ğŸ“–</span> åŒ–å­¸è¨ˆé‡è¬›ç¾©
            </a>
            <a href="#" onclick="location.reload()" class="nav-btn active">
                <span class="nav-icon">ğŸ“</span> åŒ–å­¸è¨ˆé‡æ¸¬é©—
            </a>
            <a href="../index.html" class="nav-btn">
                <span class="nav-icon">ğŸ </span> å›é¦–é 
            </a>
        </div>
    </nav>

    <div class="main-wrapper">
        <div class="container">
            <header>
                <h1>ğŸ§ª åœ‹ä¸­ç†åŒ–ï¼šåŒ–å­¸è¨ˆé‡ç‰¹è¨“</h1>
            </header>
            
            <div class="login-screen" id="loginScreen">
                <h2>å­¸ç”Ÿè³‡æ–™ç™»å…¥</h2>
                <div class="login-form">
                    <div class="form-group">
                        <label>ç­ç´š</label>
                        <select id="classSelect" class="form-control">
                            <option value="" disabled selected>è«‹é¸æ“‡ç­ç´š</option>
                            <option value="801">801</option>
                            <option value="802">802</option>
                            <option value="803">803</option>
                            <option value="804">804</option>
                            <option value="805">805</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>åº§è™Ÿ</label>
                        <div class="seat-container">
                            <select id="seatTens" class="form-control seat-select">
                                <option value="0">0</option>
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                            </select>
                            <select id="seatUnits" class="form-control seat-select">
                                <option value="" disabled selected>å€‹ä½</option>
                                </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>å§“å</label>
                        <input type="text" id="studentName" class="form-control" placeholder="è«‹è¼¸å…¥å§“å">
                    </div>

                    <button class="btn btn-submit" style="width: 100%" onclick="startQuiz()">é–‹å§‹æ¸¬é©—</button>
                </div>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>

            <div class="quiz-content" id="quizArea">
                <div id="questionTag" class="question-tag tag-basic">åŸºç¤é¡Œ</div>
                <div class="question-text" id="questionText"></div>
                <div class="options-grid" id="optionsContainer"></div>
                <div class="feedback-section" id="feedbackSection">
                    <span class="explanation-title" id="feedbackTitle"></span>
                    <div id="explanationText"></div>
                </div>
            </div>

            <div class="result-screen" id="resultArea">
                <div class="score-circle" id="finalScore">0</div>
                <h3 id="scoreMessage"></h3>
                <p id="uploadStatus" style="color: #7f8c8d; font-size: 0.9rem;">è³‡æ–™ä¸Šå‚³ä¸­...</p>
                <button class="btn btn-submit" onclick="location.reload()">é‡æ–°æŒ‘æˆ°</button>
            </div>

            <div class="loading-overlay" id="loadingOverlay">
                <div class="spinner"></div>
                <p style="margin-top: 15px;">æˆç¸¾ä¸Šå‚³ä¸­ï¼Œè«‹ç¨å€™...</p>
            </div>

            <div class="footer-controls" id="footerControls">
                <span id="questionCounter"></span>
                <div>
                    <button class="btn btn-submit" id="submitBtn" onclick="submitAnswer()">é€å‡ºç­”æ¡ˆ</button>
                    <button class="btn btn-next" id="nextBtn" onclick="nextQuestion()">ä¸‹ä¸€é¡Œ â”</button>
                </div>
            </div>
        </div>
    </div>

<script>
    // ============================================
    // âš ï¸ è¨­å®šå€ï¼šGoogle Apps Script ç¶²å€
    // ============================================
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwOZThYvU2D2JjnvvNt35CVzkN06jWfkxkmNGsNkntrE2oJLlW9mulmfgf-ozi_Fm6OTw/exec";

    // é¡Œç›®è³‡æ–™åº«
    const questions = [
        { type: "åŸºç¤è§€å¿µ", q: "åœ‹éš›ä¸Šè¨‚å®šåŸå­é‡çš„æ¨™æº–ï¼Œæ˜¯ä»¥å“ªä¸€ç¨®åŸå­ä½œç‚ºæ¯”è¼ƒåŸºæº–ï¼Œä¸¦å°‡å…¶æ•¸å€¼å®šç‚º 12ï¼Ÿ", options: ["æ°«-1", "æ°§-16", "ç¢³-12", "æ°®-14"], ans: 2, exp: "ç§‘å­¸å®¶é¸å®š<strong>ç¢³-12</strong>ç‚ºåŸå­é‡åŸºæº–ã€‚" },
        { type: "åŸºç¤è§€å¿µ", q: "ç¡«é…¸çš„åŒ–å­¸å¼ç‚º Hâ‚‚SOâ‚„ï¼Œè«‹å•å…¶åˆ†å­é‡ç‚ºå¤šå°‘ï¼Ÿ(H=1, S=32, O=16)", options: ["49", "98", "50", "100"], ans: 1, exp: "(1Ã—2) + 32 + (16Ã—4) = <strong>98</strong>ã€‚" },
        { type: "åŸºç¤è§€å¿µ", q: "ã€Œ1 è«è€³ã€çš„ç²’å­å€‹æ•¸ç´„ç‚º 6Ã—10Â²Â³ å€‹ï¼Œé€™å€‹æ•¸å€¼è¢«ç¨±ç‚ºä»€éº¼ï¼Ÿ", options: ["ç‰›é “æ•¸", "äºä½›åŠ å¥æ•¸", "é–€å¾—åˆ—å¤«æ•¸", "é”çˆ¾æ–‡æ•¸"], ans: 1, exp: "ç¨±ç‚º<strong>äºä½›åŠ å¥æ•¸</strong>ã€‚" },
        { type: "åŸºç¤è¨ˆç®—", q: "ä¸€æ¯æ°´å«æœ‰ 36 å…¬å…‹çš„æ°´ (Hâ‚‚O)ï¼Œè«‹å•é€™ç›¸ç•¶æ–¼å¤šå°‘è«è€³çš„æ°´åˆ†å­ï¼Ÿ", options: ["0.5 mol", "1 mol", "2 mol", "18 mol"], ans: 2, exp: "36 Ã· 18 = <strong>2 mol</strong>ã€‚" },
        { type: "åŸºç¤è¨ˆç®—", q: "0.5 è«è€³çš„äºŒæ°§åŒ–ç¢³ (COâ‚‚)ï¼Œè«‹å•å…¶è³ªé‡ç‚ºå¤šå°‘å…¬å…‹ï¼Ÿ", options: ["22 å…¬å…‹", "44 å…¬å…‹", "88 å…¬å…‹", "11 å…¬å…‹"], ans: 0, exp: "0.5 Ã— 44 = <strong>22 g</strong>ã€‚" },
        { type: "åŸºç¤è¨ˆç®—", q: "1 è«è€³çš„æ°«æ°£ (Hâ‚‚) å«æœ‰å¤šå°‘å€‹ã€Œæ°«åŸå­ã€ï¼Ÿ", options: ["6 Ã— 10Â²Â³", "1.2 Ã— 10Â²â´", "3 Ã— 10Â²Â³", "1"], ans: 1, exp: "1 mol Hâ‚‚ = 2 mol H åŸå­ã€‚2 Ã— 6Ã—10Â²Â³ = <strong>1.2 Ã— 10Â²â´</strong>ã€‚" },
        { type: "åæ‡‰å¼å¹³è¡¡", q: "Nâ‚‚ + _ Hâ‚‚ âŸ¶ _ NHâ‚ƒã€‚å¹³è¡¡å¾Œä¿‚æ•¸ç¸½å’Œç‚ºå¤šå°‘ï¼Ÿ", options: ["3", "5", "6", "7"], ans: 2, exp: "1Nâ‚‚ + 3Hâ‚‚ âŸ¶ 2NHâ‚ƒã€‚1+3+2 = <strong>6</strong>ã€‚" },
        { type: "è§€å¿µåˆ¤æ–·", q: "é—œæ–¼ 2Hâ‚‚ + Oâ‚‚ âŸ¶ 2Hâ‚‚Oï¼Œä¸‹åˆ—ä½•è€…éŒ¯èª¤ï¼Ÿ", options: ["åˆ†å­æ•¸æ¯” 2:1:2", "è«è€³æ•¸æ¯” 2:1:2", "è³ªé‡æ¯” 2:1:2", "æ°£é«”é«”ç©æ¯” 2:1:2"], ans: 2, exp: "ä¿‚æ•¸æ¯”<strong>ä¸ç­‰æ–¼è³ªé‡æ¯”</strong>ã€‚" },
        { type: "è³ªé‡å®ˆæ†", q: "12g ç¢³èˆ‡ 32g æ°§å®Œå…¨åæ‡‰ç”Ÿæˆ COâ‚‚ï¼ŒCOâ‚‚ è³ªé‡ç‚ºï¼Ÿ", options: ["28g", "44g", "12g", "32g"], ans: 1, exp: "12 + 32 = <strong>44g</strong>ã€‚" },
        { type: "æ°£é«”é«”ç©", q: "åŒæº«åŒå£“ä¸‹ï¼Œä¸‹åˆ—ä½•è€… 1 è«è€³é«”ç©æœ€å¤§ï¼Ÿ", options: ["Hâ‚‚", "Oâ‚‚", "COâ‚‚", "ä¸€æ¨£å¤§"], ans: 3, exp: "åŒæº«åŒå£“ä¸‹ï¼Œè«è€³æ•¸ç›¸åŒï¼Œ<strong>é«”ç©ç›¸åŒ</strong>ã€‚" },
        { type: "é€²éšæŒ‘æˆ°", q: "CaCOâ‚ƒ(100g) âŸ¶ CaO + COâ‚‚ï¼Œå¯ç”Ÿæˆå¤šå°‘ CaOï¼Ÿ(Ca=40)", options: ["28g", "44g", "56g", "100g"], ans: 2, exp: "1 mol CaCOâ‚ƒ ç”Ÿæˆ 1 mol CaO (56g)ã€‚" },
        { type: "é€²éšæŒ‘æˆ°", q: "2Hâ‚‚ + Oâ‚‚ âŸ¶ 2Hâ‚‚Oã€‚4g æ°«æ°£èˆ‡ 16g æ°§æ°£ç‡ƒç‡’ï¼Œä½•è€…éé‡ï¼Ÿ", options: ["æ°«æ°£éé‡", "æ°§æ°£éé‡", "å‰›å‰›å¥½", "ç„¡æ³•åˆ¤æ–·"], ans: 0, exp: "2mol Hâ‚‚ é… 0.5mol Oâ‚‚ã€‚Oâ‚‚ ç”¨å®Œï¼ŒHâ‚‚ <strong>éé‡</strong>ã€‚" },
        { type: "é€²éšæŒ‘æˆ°", q: "3 è«è€³è‘¡è„ç³– (Câ‚†Hâ‚â‚‚Oâ‚†) å«å¤šå°‘è«è€³æ°§åŸå­ï¼Ÿ", options: ["3 mol", "6 mol", "9 mol", "18 mol"], ans: 3, exp: "3 Ã— 6 = <strong>18 mol</strong>ã€‚" },
        { type: "é€²éšæŒ‘æˆ°", q: "å–ã€Œç›¸åŒè³ªé‡ã€æ°£é«”ï¼Œä½•è€…åˆ†å­æ•¸æœ€å¤šï¼Ÿ", options: ["Hâ‚‚", "CHâ‚„", "Oâ‚‚", "COâ‚‚"], ans: 0, exp: "è³ªé‡ç›¸åŒï¼Œ<strong>åˆ†å­é‡è¶Šå°</strong> (Hâ‚‚=2)ï¼Œåˆ†å­æ•¸è¶Šå¤šã€‚" },
        { type: "é€²éšæŒ‘æˆ°", q: "CxHy + Oâ‚‚ âŸ¶ 3COâ‚‚ + 4Hâ‚‚Oï¼Œæ±‚ CxHyï¼Ÿ", options: ["Câ‚ƒHâ‚„", "Câ‚ƒHâ‚ˆ", "Câ‚„Hâ‚ˆ", "Câ‚„Hâ‚â‚€"], ans: 1, exp: "C=3, H=4Ã—2=8 â” <strong>Câ‚ƒHâ‚ˆ</strong>ã€‚" }
    ];

    // ç‹€æ…‹è®Šæ•¸
    let currentQuestion = 0;
    let score = 0;
    let selectedOption = null;
    let studentData = {};
    let answerResults = [];

    // åˆå§‹åŒ–ï¼šç”¢ç”Ÿå€‹ä½æ•¸é¸é …
    const unitSelect = document.getElementById('seatUnits');
    for(let i=0; i<=9; i++) {
        let opt = document.createElement('option');
        opt.value = i;
        opt.text = i;
        unitSelect.appendChild(opt);
    }

    // 1. ç™»å…¥èˆ‡é–‹å§‹
    function startQuiz() {
        const cls = document.getElementById('classSelect').value;
        const ten = document.getElementById('seatTens').value;
        const unit = document.getElementById('seatUnits').value;
        const name = document.getElementById('studentName').value.trim();

        if (!cls || !unit || !name) {
            alert("è«‹å®Œæ•´å¡«å¯«ç­ç´šã€åº§è™Ÿèˆ‡å§“åï¼");
            return;
        }

        studentData = {
            class: cls,
            seat: ten + unit,
            name: name
        };

        // UI åˆ‡æ›
        document.getElementById('loginScreen').style.display = 'none';
        document.getElementById('quizArea').style.display = 'block';
        document.getElementById('footerControls').style.display = 'flex';
        loadQuestion();
    }

    // 2. è¼‰å…¥é¡Œç›®
    function loadQuestion() {
        selectedOption = null;
        document.getElementById('feedbackSection').style.display = 'none';
        document.getElementById('submitBtn').style.display = 'block';
        document.getElementById('submitBtn').disabled = true;
        document.getElementById('nextBtn').style.display = 'none';

        const qData = questions[currentQuestion];
        document.getElementById('questionText').innerHTML = qData.q;
        document.getElementById('questionTag').textContent = qData.type;
        document.getElementById('questionTag').className = 'question-tag ' + (qData.type.includes('é€²éš') ? 'tag-advanced' : 'tag-basic');
        document.getElementById('questionCounter').textContent = `ç¬¬ ${currentQuestion + 1} / ${questions.length} é¡Œ`;

        const progress = (currentQuestion / questions.length) * 100;
        document.getElementById('progressFill').style.width = `${progress}%`;

        const container = document.getElementById('optionsContainer');
        container.innerHTML = '';
        qData.options.forEach((opt, index) => {
            const btn = document.createElement('div');
            btn.className = 'option-btn';
            btn.innerHTML = opt;
            btn.onclick = () => selectOption(index, btn);
            container.appendChild(btn);
        });
    }

    function selectOption(index, element) {
        if (document.getElementById('nextBtn').style.display === 'block') return;
        document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
        element.classList.add('selected');
        selectedOption = index;
        document.getElementById('submitBtn').disabled = false;
    }

    // 3. é€å‡ºå–®é¡Œç­”æ¡ˆ
    function submitAnswer() {
        if (selectedOption === null) return;
        const qData = questions[currentQuestion];
        const buttons = document.querySelectorAll('.option-btn');
        const isCorrect = (selectedOption === qData.ans);
        
        answerResults.push(isCorrect);

        buttons[qData.ans].classList.add('correct');
        if (isCorrect) {
            score++;
            document.getElementById('feedbackTitle').innerHTML = "<span style='color:#27ae60'>âœ… ç­”å°äº†ï¼</span>";
            document.getElementById('feedbackSection').className = "feedback-section feedback-correct";
        } else {
            buttons[selectedOption].classList.add('wrong');
            document.getElementById('feedbackTitle').innerHTML = "<span style='color:#c0392b'>âŒ ç­”éŒ¯äº†ï¼</span>";
            document.getElementById('feedbackSection').className = "feedback-section feedback-wrong";
        }

        document.getElementById('explanationText').innerHTML = qData.exp;
        document.getElementById('feedbackSection').style.display = 'block';
        buttons.forEach(btn => btn.classList.add('disabled'));
        document.getElementById('submitBtn').style.display = 'none';
        document.getElementById('nextBtn').style.display = 'block';

        if (currentQuestion === questions.length - 1) {
            document.getElementById('nextBtn').textContent = "æŸ¥çœ‹æˆç¸¾ä¸¦é€å‡º";
        }
    }

    // 4. ä¸‹ä¸€é¡Œæˆ–çµæŸ
    function nextQuestion() {
        if (currentQuestion < questions.length - 1) {
            currentQuestion++;
            loadQuestion();
        } else {
            finishQuiz();
        }
    }

    // 5. çµæŸä¸¦ä¸Šå‚³è³‡æ–™
    function finishQuiz() {
        document.getElementById('quizArea').style.display = 'none';
        document.getElementById('footerControls').style.display = 'none';
        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('progressFill').style.width = '100%';
        
        document.getElementById('finalScore').textContent = score;
        document.getElementById('scoreMessage').textContent = score === 15 ? "å¤ªç¥äº†ï¼å…¨å°ï¼" : "æ¸¬é©—å®Œæˆï¼";

        uploadData();
    }

    function uploadData() {
        document.getElementById('loadingOverlay').style.display = 'flex';

        const payload = {
            userClass: studentData.class,
            seatNo: studentData.seat,
            userName: studentData.name,
            score: score,
            results: answerResults
        };

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload),
            mode: 'no-cors',
            headers: {
                'Content-Type': 'text/plain;charset=utf-8'
            }
        }).then(() => {
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('uploadStatus').innerHTML = "âœ… æˆç¸¾å·²æˆåŠŸä¸Šå‚³è‡³ç´€éŒ„è¡¨ï¼";
            document.getElementById('uploadStatus').style.color = "#27ae60";
            document.getElementById('uploadStatus').style.fontWeight = "bold";
        }).catch(err => {
            document.getElementById('loadingOverlay').style.display = 'none';
            document.getElementById('uploadStatus').textContent = "âŒ ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ã€‚";
            console.error('Upload Error:', err);
        });
    }

</script>
</body>
</html>